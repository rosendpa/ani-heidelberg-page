<!DOCTYPE html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="stylesheet" href="cal_style.css">
    <script src="https://code.jquery.com/jquery-3.5.0.js"></script>
</head>


<body>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter&display=swap" rel="stylesheet">

  <div class="container">
    <calout></calout>
  </div>
  
  

  <script>
  var schedule = []
    function ajaxCallBack(retString){
      schedule = retString;

      //Starte Kalenderbau
      const months = ["Januar", "Februar", "März", "April", "Mai", "Juni", "Juli", "August", "September", "Oktober", "November", "Dezember"];
      const now = new Date();
      
      // first prefix
      $("calout").append(
                          "<table>"+
                              "<thead>"+
                                "<tr>"+
                                  "<th colspan='7' style='text-align:center'>"+months[now.getMonth()]+" "+now.getFullYear()+"</th>"+
                                "</tr>"+
                                "<tr>"+
                                  "<th style='text-align:center'>月</th>"+
                                  "<th style='text-align:center'>火</th>"+
                                  "<th style='text-align:center'>水</th>"+
                                  "<th style='text-align:center'>木</th>"+
                                  "<th style='text-align:center'>金</th>"+
                                  "<th style='text-align:center'>土</th>"+
                                  "<th style='text-align:center'>日</th>"+
                                "</tr>"+
                              "</thead>"+
                              "<tbody>"+
                                "<tr>"
                        )
      
      // fist day and offset                            
      const month_start = new Date(now.getFullYear(),now.getMonth(),1,12,0,0)
      let offset = month_start.getDay()-1
      if (offset<0){
        offset = 6
      }
      for (i=0;i<offset; i++){
        $("calout").append("<td colspan=1></td>")
      }

      //alle tage einzeln eintragen
      iterator = month_start
      do {
        //alle marker sammeln
        let string = ""
        string = string + "<td class ='"
        if(now.getDate()>iterator.getDate()){
          string = string + "past "
        }
        if(now.getDate()==iterator.getDate()){
          string = string + "today "
        }
        for (var i = 0; i < schedule.length; i++) {
          if (schedule[i][0].getMonth() == iterator.getMonth()){
            if (schedule[i][0].getDate() == iterator.getDate()){
              if(schedule[i][2] == "A"){
                string = string + "markA "
              }
              if(schedule[i][2] == "B"){
                string = string + "markB "
              }
              if(schedule[i][2] == "S"){
                string = string + "markS "
              }
              string = string + "' title='"+("00" + schedule[i][0].getHours()).slice(-2) + ":" + ("00" + schedule[i][0].getMinutes()).slice(-2) + " - " + schedule[i][1]
            }
          }
        }
       //marker eintragen
        string = string + "'>"+iterator.getDate()+"</td>";
        $("calout").append(string)

       //position testen
        offset = offset + 1
        if (offset>6){
          offset = 0
          $("calout").append(
            "</tr>"+
            "<tr>"
          )
        }
        iterator.setDate(iterator.getDate()+1)      
        //bis monatsende
      } while(iterator.getMonth()==now.getMonth())

      //suffix
      $("calout").append(
            "</tr>"+
          "</tbody>"+
        "</table>")

      //repeat
        $("calout").append(
                          "<table>"+
                              "<thead>"+
                                "<tr>"+
                                  "<th colspan='7' style='text-align:center'>"+months[iterator.getMonth()]+" "+iterator.getFullYear()+"</th>"+
                                "</tr>"+
                                "<tr>"+
                                  "<th style='text-align:center'>月</th>"+
                                  "<th style='text-align:center'>火</th>"+
                                  "<th style='text-align:center'>水</th>"+
                                  "<th style='text-align:center'>木</th>"+
                                  "<th style='text-align:center'>金</th>"+
                                  "<th style='text-align:center'>土</th>"+
                                  "<th style='text-align:center'>日</th>"+
                                "</tr>"+
                              "</thead>"+
                              "<tbody>"+
                                "<tr>"
        )
             
      if (offset>0){
        for (i=0;i<offset; i++){
          $("calout").append("<td colspan=1></td>")
        }
      }
      
      do {
        let string = ""
        string = string + "<td class ='"
        for (var i = 0; i < schedule.length; i++) {
          if (schedule[i][0].getMonth() == iterator.getMonth()){
            if (schedule[i][0].getDate() == iterator.getDate()){
              if(schedule[i][2] == "A"){
                string = string + "markA "
              }
              if(schedule[i][2] == "B"){
                string = string + "markB "
              }
              if(schedule[i][2] == "S"){
                string = string + "markS "
              }
              string = string + "' title='"+("00" + schedule[i][0].getHours()).slice(-2) + ":" + ("00" + schedule[i][0].getMinutes()).slice(-2) + " - " + schedule[i][1]
            }
          }
        }
        string = string + "'>"+iterator.getDate()+"</td>";
        $("calout").append(string)

        offset = offset + 1
        if (offset>6){
          offset = 0
          $("calout").append(
            "</tr>"+
            "<tr>"
          )
        }
        iterator.setDate(iterator.getDate()+1)      
      } while(iterator.getMonth()==now.getMonth()+1)

      $("calout").append(
            "</tr>"+
          "</tbody>"+
        "</table>")        
    }
  </script>


  

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js">
  
  </script>
    <script>
        $(function () {
          
            $.ajax({
                url: "https://rosendpa.github.io/ani-heidelberg-page/dates.json",
                cache: false, 
                success: function (result) {
                  
                var schedule = []
                    $.each(result, function (index, item) {
                        schedule.push([new Date(item.date),  item.title,  item.type])
                      });
                
                ajaxCallBack(schedule)
                
                }
                
            });
        })
    </script>





  <script>
    
  
    


    
                      

  </script>




  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>       
</body>
</html>